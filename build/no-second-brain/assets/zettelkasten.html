<!DOCTYPE html>
<html>
<head>
    <title>Магнитные идеи</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        .idea {
            position: absolute;
            width: 80px;
            height: 40px;
            border: 1px dashed #00F;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #00F;
            background: white;
            cursor: move;
            transition: all 0.3s ease;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        button {
            background: #00F;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="addIdea()">+ Идея</button>
        <button onclick="reset()">Заново</button>
    </div>

    <script>
        let ideas = [];
        let isAttracting = false;
        let attractionInterval;

        function addIdea() {
            const idea = {
                id: ideas.length,
                x: Math.random() * (window.innerWidth - 100),
                y: Math.random() * (window.innerHeight - 60),
                element: null,
                cluster: null
            };
            
            const element = document.createElement('div');
            element.className = 'idea';
            element.textContent = 'Идея';
            element.style.left = idea.x + 'px';
            element.style.top = idea.y + 'px';
            
            // Перетаскивание
            element.onmousedown = function(e) {
                const startX = e.clientX - idea.x;
                const startY = e.clientY - idea.y;
                
                function moveAt(e) {
                    idea.x = e.clientX - startX;
                    idea.y = e.clientY - startY;
                    element.style.left = idea.x + 'px';
                    element.style.top = idea.y + 'px';
                }
                
                document.addEventListener('mousemove', moveAt);
                
                document.onmouseup = function() {
                    document.removeEventListener('mousemove', moveAt);
                    document.onmouseup = null;
                };
            };
            
            document.body.appendChild(element);
            idea.element = element;
            ideas.push(idea);
            
            // Начинаем притяжение, если идей достаточно
            if (ideas.length >= 3 && !isAttracting) {
                startAttraction();
            }
        }

        function startAttraction() {
            isAttracting = true;
            
            attractionInterval = setInterval(() => {
                // Для каждой идеи находим ближайших соседей и притягиваемся к ним
                ideas.forEach(idea => {
                    let totalX = 0;
                    let totalY = 0;
                    let neighbors = 0;
                    
                    // Ищем соседей в радиусе 200px
                    ideas.forEach(other => {
                        if (idea.id !== other.id) {
                            const dx = other.x - idea.x;
                            const dy = other.y - idea.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < 200) {
                                totalX += other.x;
                                totalY += other.y;
                                neighbors++;
                            }
                        }
                    });
                    
                    // Если есть соседи, двигаемся к их центру масс
                    if (neighbors > 0) {
                        const centerX = totalX / neighbors;
                        const centerY = totalY / neighbors;
                        
                        // Медленное движение к центру
                        idea.x += (centerX - idea.x) * 0.02;
                        idea.y += (centerY - idea.y) * 0.02;
                        
                        idea.element.style.left = idea.x + 'px';
                        idea.element.style.top = idea.y + 'px';
                        
                        // Меняем цвет при сближении
                        const intensity = Math.min(neighbors / 3, 1);
                        idea.element.style.borderColor = `rgb(0, 0, ${255 * intensity})`;
                        idea.element.style.background = `rgba(0, 0, 255, ${0.1 * intensity})`;
                    }
                });
                
                // Автоматическое образование кластеров
                formClusters();
                
            }, 50);
        }

        function formClusters() {
            // Простой алгоритм кластеризации
            ideas.forEach(idea => {
                idea.cluster = null;
            });
            
            let clusterId = 0;
            
            ideas.forEach(idea => {
                if (idea.cluster === null) {
                    idea.cluster = clusterId;
                    // Находим всех соседей в радиусе 100px и добавляем в кластер
                    ideas.forEach(other => {
                        if (other.cluster === null) {
                            const dx = other.x - idea.x;
                            const dy = other.y - idea.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < 100) {
                                other.cluster = clusterId;
                            }
                        }
                    });
                    clusterId++;
                }
            });
            
            // Визуализируем кластеры разными оттенками
            ideas.forEach(idea => {
                if (idea.cluster !== null) {
                    const hue = (idea.cluster * 60) % 360;
                    idea.element.style.borderColor = `hsl(${hue}, 100%, 50%)`;
                    idea.element.style.color = `hsl(${hue}, 100%, 50%)`;
                }
            });
        }

        function reset() {
            // Останавливаем притяжение
            clearInterval(attractionInterval);
            isAttracting = false;
            
            // Удаляем все идеи
            ideas.forEach(idea => {
                if (idea.element) {
                    idea.element.remove();
                }
            });
            ideas = [];
        }

        // Добавляем первые идеи для демонстрации
        setTimeout(() => {
            addIdea();
            addIdea();
            addIdea();
        }, 100);
    </script>
</body>
</html>
