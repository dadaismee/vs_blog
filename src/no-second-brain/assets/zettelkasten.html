<!DOCTYPE html>
<html>
<head>
    <title>–£–º–Ω—ã–µ –º–∞–≥–Ω–∏—Ç–Ω—ã–µ –∏–¥–µ–∏</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: white;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }
        
        .idea {
            position: absolute;
            width: 80px;
            height: 40px;
            border: 1px dashed #00F;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #00F;
            background: white;
            cursor: move;
            transition: all 0.3s ease;
            flex-direction: column;
            padding: 2px;
            z-index: 2;
        }
        
        .address {
            font-size: 8px;
            color: #666;
            margin-bottom: 2px;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        button {
            background: #00F;
            color: white;
            border: none;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .connection {
            position: absolute;
            background: #00F;
            height: 1px;
            transform-origin: 0 0;
            pointer-events: none;
            opacity: 0.5;
            z-index: 1;
            transition: opacity 0.5s ease;
        }
        
        .connection.fading {
            opacity: 0;
        }
        
        .cluster-1 { border-color: #FF6B6B; color: #FF6B6B; }
        .cluster-2 { border-color: #4ECDC4; color: #4ECDC4; }
        .cluster-3 { border-color: #FFD166; color: #FFD166; }
        .cluster-4 { border-color: #06D6A0; color: #06D6A0; }
        .cluster-5 { border-color: #118AB2; color: #118AB2; }
        
        .sequence-path {
            position: absolute;
            background: rgba(255, 0, 0, 0.3);
            height: 3px;
            transform-origin: 0 0;
            pointer-events: none;
            z-index: 0;
        }
        
        .sequence-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 8px solid red;
            pointer-events: none;
            z-index: 0;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="addIdea()">+ –ò–¥–µ—è</button>
        <!-- <button onclick="showRandomSequence()">üîç –ü–æ–∫–∞–∑–∞—Ç—å —Ü–µ–ø–æ—á–∫—É</button> -->
        <button onclick="reset()">–ó–∞–Ω–æ–≤–æ</button>
    </div>

    <script>
        let ideas = [];
        let isAttracting = false;
        let attractionInterval;
        let addressCounter = 1;
        let currentCluster = 1;
        let connectionTimeout;

        function generateAddress() {
            const base = Math.floor((addressCounter - 1) / 3) + 1;
            const suffix = ['', 'a', 'b', 'c'][(addressCounter - 1) % 4];
            addressCounter++;
            return base + suffix;
        }

        function addIdea() {
            // –ò–Ω–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –∫–ª–∞—Å—Ç–µ—Ä (30% chance)
            if (ideas.length > 3 && Math.random() < 0.3) {
                currentCluster = (currentCluster % 5) + 1;
            }
            
            const idea = {
                id: ideas.length,
                address: generateAddress(),
                x: Math.random() * (window.innerWidth - 100),
                y: Math.random() * (window.innerHeight - 60),
                element: null,
                connections: [],
                cluster: currentCluster,
                sequenceOrder: null
            };
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ–±—ã –Ω–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ –Ω–∞–µ–∑–∂–∞–ª–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
            let overlapping = true;
            let attempts = 0;
            while (overlapping && attempts < 50) {
                overlapping = false;
                for (const existingIdea of ideas) {
                    const dx = idea.x - existingIdea.x;
                    const dy = idea.y - existingIdea.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    if (distance < 100) {
                        overlapping = true;
                        idea.x = Math.random() * (window.innerWidth - 100);
                        idea.y = Math.random() * (window.innerHeight - 60);
                        break;
                    }
                }
                attempts++;
            }
            
            const element = document.createElement('div');
            element.className = `idea cluster-${idea.cluster}`;
            element.innerHTML = `
                <div class="address">${idea.address}</div>
                <div>–ò–¥–µ—è</div>
            `;
            element.style.left = idea.x + 'px';
            element.style.top = idea.y + 'px';
            
            // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ
            element.onmousedown = function(e) {
                const startX = e.clientX - idea.x;
                const startY = e.clientY - idea.y;
                
                function moveAt(e) {
                    idea.x = e.clientX - startX;
                    idea.y = e.clientY - startY;
                    element.style.left = idea.x + 'px';
                    element.style.top = idea.y + 'px';
                    updateConnections();
                }
                
                document.addEventListener('mousemove', moveAt);
                
                document.onmouseup = function() {
                    document.removeEventListener('mousemove', moveAt);
                    document.onmouseup = null;
                };
            };
            
            // –ö–ª–∏–∫ –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            element.onclick = function(e) {
                if (e.ctrlKey) { // Ctrl+click –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ü–µ–ø–æ—á–∫–∏
                    showSequenceFromIdea(idea);
                }
            };
            
            document.body.appendChild(element);
            idea.element = element;
            ideas.push(idea);
            
            // –°–æ–∑–¥–∞—ë–º —Å–≤—è–∑–∏ —Å –∏–¥–µ—è–º–∏ –∏–∑ —Ç–æ–≥–æ –∂–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
            if (ideas.length > 1) {
                createClusterConnections(idea);
            }
            
            if (ideas.length >= 2 && !isAttracting) {
                startAttraction();
            }
        }

        function createClusterConnections(newIdea) {
            // –°–≤—è–∑—ã–≤–∞–µ–º —Å –∏–¥–µ—è–º–∏ –∏–∑ —Ç–æ–≥–æ –∂–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
            ideas.forEach(existingIdea => {
                if (existingIdea.id !== newIdea.id && existingIdea.cluster === newIdea.cluster) {
                    if (!existingIdea.connections.includes(newIdea.id)) {
                        existingIdea.connections.push(newIdea.id);
                    }
                    if (!newIdea.connections.includes(existingIdea.id)) {
                        newIdea.connections.push(existingIdea.id);
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–≤—è–∑–∏ –≤ –∞–¥—Ä–µ—Å–∞—Ö
                    existingIdea.element.innerHTML = `
                        <div class="address">${existingIdea.address} ‚Üí ${newIdea.address}</div>
                        <div>–ò–¥–µ—è</div>
                    `;
                    newIdea.element.innerHTML = `
                        <div class="address">${newIdea.address} ‚Üê ${existingIdea.address}</div>
                        <div>–ò–¥–µ—è</div>
                    `;
                }
            });
            
            updateConnections();
            
            // –ü—Ä—è—á–µ–º —Å–≤—è–∑–∏ —á–µ—Ä–µ–∑ 8 —Å–µ–∫—É–Ω–¥
            clearTimeout(connectionTimeout);
            connectionTimeout = setTimeout(() => {
                document.querySelectorAll('.connection').forEach(conn => {
                    conn.classList.add('fading');
                });
            }, 8000);
        }

        function startAttraction() {
            isAttracting = true;
            
            attractionInterval = setInterval(() => {
                ideas.forEach(idea => {
                    let attractionX = 0;
                    let attractionY = 0;
                    let repulsionX = 0;
                    let repulsionY = 0;
                    let connectedCount = 0;
                    let repulsionCount = 0;
                    
                    // –ü—Ä–∏—Ç—è–∂–µ–Ω–∏–µ –∫ —Å–≤—è–∑–∞–Ω–Ω—ã–º –∏–¥–µ—è–º –∏–∑ —Ç–æ–≥–æ –∂–µ –∫–ª–∞—Å—Ç–µ—Ä–∞
                    idea.connections.forEach(connectedId => {
                        const connectedIdea = ideas.find(i => i.id === connectedId);
                        if (connectedIdea && connectedIdea.cluster === idea.cluster) {
                            const dx = connectedIdea.x - idea.x;
                            const dy = connectedIdea.y - idea.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance > 80) {
                                attractionX += dx * 0.02;
                                attractionY += dy * 0.02;
                            }
                            connectedCount++;
                        }
                    });
                    
                    // –û—Ç—Ç–∞–ª–∫–∏–≤–∞–Ω–∏–µ –æ—Ç –≤—Å–µ—Ö –±–ª–∏–∑–∫–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
                    ideas.forEach(otherIdea => {
                        if (otherIdea.id !== idea.id) {
                            const dx = idea.x - otherIdea.x;
                            const dy = idea.y - otherIdea.y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < 60) {
                                const force = (60 - distance) / 60 * 0.1;
                                repulsionX += (dx / distance) * force;
                                repulsionY += (dy / distance) * force;
                                repulsionCount++;
                            }
                        }
                    });
                    
                    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∏–ª—ã
                    if (connectedCount > 0) {
                        idea.x += attractionX;
                        idea.y += attractionY;
                    }
                    
                    if (repulsionCount > 0) {
                        idea.x += repulsionX;
                        idea.y += repulsionY;
                    }
                    
                    // –ì—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞
                    idea.x = Math.max(10, Math.min(window.innerWidth - 90, idea.x));
                    idea.y = Math.max(10, Math.min(window.innerHeight - 50, idea.y));
                    
                    idea.element.style.left = idea.x + 'px';
                    idea.element.style.top = idea.y + 'px';
                });
                
                updateConnections();
                
            }, 50);
        }

        function updateConnections() {
            document.querySelectorAll('.connection').forEach(el => el.remove());
            
            ideas.forEach(idea => {
                idea.connections.forEach(connectedId => {
                    const connectedIdea = ideas.find(i => i.id === connectedId);
                    if (connectedIdea) {
                        const connection = document.createElement('div');
                        connection.className = 'connection';
                        connection.style.background = getClusterColor(idea.cluster);
                        
                        const dx = connectedIdea.x - idea.x;
                        const dy = connectedIdea.y - idea.y;
                        const length = Math.sqrt(dx * dx + dy * dy);
                        const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                        
                        connection.style.width = length + 'px';
                        connection.style.left = idea.x + 40 + 'px';
                        connection.style.top = idea.y + 20 + 'px';
                        connection.style.transform = `rotate(${angle}deg)`;
                        
                        document.body.appendChild(connection);
                    }
                });
            });
        }

        function showRandomSequence() {
            if (ideas.length < 2) return;
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–ª—É—á–∞–π–Ω—É—é —Ü–µ–ø–æ—á–∫—É –∏–∑ 3-5 –∏–¥–µ–π
            const sequence = [];
            let current = ideas[Math.floor(Math.random() * ideas.length)];
            
            while (sequence.length < 5 && current) {
                sequence.push(current);
                if (current.connections.length > 0) {
                    const nextId = current.connections[Math.floor(Math.random() * current.connections.length)];
                    current = ideas.find(i => i.id === nextId);
                    if (sequence.includes(current)) break; // –ò–∑–±–µ–≥–∞–µ–º —Ü–∏–∫–ª–æ–≤
                } else {
                    break;
                }
            }
            
            showSequence(sequence);
        }

        function showSequenceFromIdea(startIdea) {
            const sequence = [startIdea];
            let current = startIdea;
            
            // –°—Ç—Ä–æ–∏–º —Ü–µ–ø–æ—á–∫—É –∏–∑ 3-4 —Å–ª–µ–¥—É—é—â–∏—Ö –∏–¥–µ–π
            for (let i = 0; i < 3; i++) {
                if (current.connections.length > 0) {
                    const nextId = current.connections[Math.floor(Math.random() * current.connections.length)];
                    const nextIdea = ideas.find(i => i.id === nextId);
                    if (nextIdea && !sequence.includes(nextIdea)) {
                        sequence.push(nextIdea);
                        current = nextIdea;
                    } else {
                        break;
                    }
                } else {
                    break;
                }
            }
            
            showSequence(sequence);
        }

        function showSequence(sequence) {
            // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø—É—Ç–∏
            document.querySelectorAll('.sequence-path, .sequence-arrow').forEach(el => el.remove());
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
            ideas.forEach(idea => {
                idea.element.style.transform = 'scale(1)';
                idea.element.style.zIndex = '2';
            });
            
            // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∏ –∞–Ω–∏–º–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
            sequence.forEach((idea, index) => {
                idea.sequenceOrder = index;
                idea.element.style.transform = 'scale(1.2)';
                idea.element.style.zIndex = '3';
                
                // –†–∏—Å—É–µ–º –ø—É—Ç—å –∫ —Å–ª–µ–¥—É—é—â–µ–π –∏–¥–µ–µ
                if (index < sequence.length - 1) {
                    const nextIdea = sequence[index + 1];
                    
                    // –õ–∏–Ω–∏—è –ø—É—Ç–∏
                    const path = document.createElement('div');
                    path.className = 'sequence-path';
                    
                    const dx = nextIdea.x - idea.x;
                    const dy = nextIdea.y - idea.y;
                    const length = Math.sqrt(dx * dx + dy * dy);
                    const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                    
                    path.style.width = length + 'px';
                    path.style.left = idea.x + 40 + 'px';
                    path.style.top = idea.y + 20 + 'px';
                    path.style.transform = `rotate(${angle}deg)`;
                    
                    document.body.appendChild(path);
                    
                    // –°—Ç—Ä–µ–ª–∫–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    const arrow = document.createElement('div');
                    arrow.className = 'sequence-arrow';
                    arrow.style.left = (idea.x + 40 + length * 0.5 - 5) + 'px';
                    arrow.style.top = (idea.y + 20 + length * 0.5 * Math.sin(angle * Math.PI / 180) - 8) + 'px';
                    arrow.style.transform = `rotate(${angle}deg)`;
                    
                    document.body.appendChild(arrow);
                }
            });
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                document.querySelectorAll('.sequence-path, .sequence-arrow').forEach(el => el.remove());
                ideas.forEach(idea => {
                    idea.element.style.transform = 'scale(1)';
                    idea.element.style.zIndex = '2';
                });
            }, 10000);
        }

        function getClusterColor(cluster) {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFD166', '#06D6A0', '#118AB2'];
            return colors[(cluster - 1) % colors.length];
        }

        function reset() {
            clearInterval(attractionInterval);
            clearTimeout(connectionTimeout);
            isAttracting = false;
            ideas.forEach(idea => idea.element.remove());
            ideas = [];
            addressCounter = 1;
            currentCluster = 1;
            document.querySelectorAll('.connection, .sequence-path, .sequence-arrow').forEach(el => el.remove());
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–µ –∏–¥–µ–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        setTimeout(() => {
            addIdea();
            addIdea();
        }, 100);
    </script>
</body>
</html>
